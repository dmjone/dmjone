<!-------------------------- © 2007 - present, dmj.one and contributors. ----------------------------------
   Part of the dmjone project. Licensed under the GNU AGPL. Provided as-is, without warranty of any kind. 
-------------------- Redistribution and modifications must retain this notice. --------------------------->


<!DOCTYPE html>
<!--[if lte 8]><html class="pre-ie9" lang="en"><![endif]-->
<!--[if gte IE 9]><!-->
<html lang="en">
    <!--<![endif]-->

    <head>
        <script src="/js/edu_su_common.js"></script>
        <noscript>
            <style>
                html,
                body {
                    margin: 0;
                    overflow: hidden;
                }
            </style>
            <iframe src="/frame_noscript.html" style="width:100%;height:100vh;border:none;display:block"></iframe>
        </noscript>

        <title>Placement Training</title>
        <meta name="description" content="Prepare for your placements with these random questions Based on B.Tech. CSE Syllabus">
        <meta property="og:image" content="/logo.png">
        <meta property="og:type" content="article">

        <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@divyamohan1993">
        <meta name="twitter:creator" content="@divyamohan1993">
        <meta name="twitter:image" content="/logo.png">

        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />

        <meta name="author" content="Divya Mohan">
        <meta name="robots" content="index, follow">

        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.4/katex.min.js" integrity="sha512-sHSNLECRJSK+BFs7E8DiFc6pf6n90bLI85Emiw1jhreduZhK3VXgq9l4kAt9eTIHYAcuQBKHL01QKs4/3Xgl8g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.4/contrib/auto-render.min.js" integrity="sha512-iWiuBS5nt6r60fCz26Nd0Zqe0nbk1ZTIQbl3Kv7kYsX+yKMUFHzjaH2+AnM6vp2Xs+gNmaBAVWJjSmuPw76Efg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                renderMathInElement(document.body, {
                    // customised options
                    // • auto-render specific keys, e.g.:
                    delimiters: [
                        { left: '$$', right: '$$', display: true },
                        { left: '$', right: '$', display: false },
                        { left: '\\(', right: '\\)', display: false },
                        { left: '\\[', right: '\\]', display: true }
                    ],
                    // • rendering keys, e.g.:
                    throwOnError: false
                });
            });
        </script>
        <style>
            .container {
                margin-top: 80px;
            }

            .option {
                padding: 10px;
                border: 1px solid #007bff;
                border-radius: 5px;
                margin-bottom: 10px;
                font-size: 1.1em;
                transition: background-color 0.3s ease, transform 0.3s ease;
            }

            .option:hover {
                background-color: hsl(180, 100%, 36%);
                color: white;
                cursor: pointer;
                box-shadow: 0px 10px 15px rgba(224, 255, 255, 0.3);
                transform: scale(1.02);
            }

            .option.selected {
                background-color: #28a745;
                color: white;
            }

            .options .form-check-input {
                display: none;
            }

            .score-container,
            .timer-container,
            .name-container,
            .negative-marking-warning {
                z-index: 1000;
                margin-top: 75px;
            }

            .name-container,
            .timer-container,
            .score-container,
            .negative-marking-warning {
                margin-top: 50px;
                padding: 10px 20px;
                background: linear-gradient(45deg, #ff6f61, #ff9068);
                color: white;
                font-size: 1.5em;
                font-weight: bold;
                border-radius: 10px;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            }

            .timer-container {
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
            }

            .name-container {
                position: fixed;
                top: 20px;
                left: 20px;
            }

            .score-container {
                position: fixed;
                top: 20px;
                right: 20px;
            }

            .negative-marking-warning {
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: red;
                display: none;
            }

            .card {
                border-radius: 10px;
                overflow: hidden;
                margin-bottom: 20px;
                border: 1px solid;
                border-color: var(--text-color);
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
                transition: transform 0.3s ease, box-shadow 0.3s ease;
                color: var(--text-color);
                --bs-card-bg: var(--background-color);
            }

            .card:hover {
                transform: translateY(-10px);
                box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            }

            .card-header {
                background-color: #007bff;
                color: white;
                font-size: 1.2em;
                font-weight: bold;
                min-height: 150px;
                display: flex;
                flex-direction: column-reverse;
                align-items: center;
                justify-content: center;
                text-align: center;
            }

            .card-header.correct {
                background-color: #28a745;
            }

            .card-header.incorrect {
                background-color: #dc3545;
            }

            .card-body.correct {
                background-color: #d4edda;
            }

            .card-body.incorrect {
                background-color: #f8d7da;
            }

            .card-body.disabled {
                pointer-events: none;
                opacity: 0.6;
            }

            .card-body {
                transition: background-color 0.3s ease;
            }

            .form-check-label {
                margin-left: 10px;
            }

            .form-check-input {
                margin-left: 0;
            }

            .modal-content {
                background: linear-gradient(45deg, #6a11cb, #2575fc);
                color: white;
            }

            .modal-content h2,
            .modal-content p {
                color: white;
            }

            .blur {
                filter: blur(5px);
            }

            .darken {
                background-color: rgba(0, 0, 0, 0.5);
            }

            .d-none {
                display: none !important;
            }

            .row.row-cols-1 .col {
                display: flex;
            }

            .card {
                display: flex;
                flex-direction: column;
                flex: 1;
            }

            .card-body {
                display: flex;
                flex-direction: column;
                justify-content: first baseline;
            }

            .card-header {
                display: flex;
                flex-direction: column;
                justify-content: first baseline;
            }
        </style>
    </head>

    <body>
        <div class="name-container" id="name-container"></div>
        <div class="timer-container" id="timer-container">
            <div class="timer text-center" id="timer">Start Answering!</div>
        </div>
        <div class="score-container" id="score-container">0/0</div>
        <div class="negative-marking-warning" id="negative-marking-warning"></div>
        <div class="container">
            <h2 class="my-9 text-center display-3">Lets get you trained!</h2>
            <div id="questions-container" class="row row-cols-1 row-cols-md-2 g-4"></div>
        </div>
        <div class="modal fade" id="endModal" tabindex="-1" aria-labelledby="endModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content text-center p-5">
                    <h2 id="final-score"></h2>
                    <p id="congrats-message"></p>
                    <p id="time-taken" class="text-center"></p>
                    <p class="text-center fw-bold">The page will refresh automatically in 15 seconds.</p>
                </div>
            </div>
        </div>
        <script>
            (function () {
                const MIN_QUESTIONS = 3;
                const MAX_QUESTIONS = 5;
                const MIN_TIME_PER_QUESTION = 5;
                const MAX_TIME_PER_QUESTION = 30;
                const SCORE_CONTAINER_ID = 'score-container';
                const TIMER_ELEMENT_ID = 'timer';
                const NAME_CONTAINER_ID = 'name-container';
                const QUESTIONS_CONTAINER_ID = 'questions-container';
                const FINAL_SCORE_ID = 'final-score';
                const CONGRATS_MESSAGE_ID = 'congrats-message';
                const TIME_TAKEN_ID = 'time-taken';
                const END_MODAL_ID = 'endModal';
                let NEGATIVE_MARKING_ENABLED = 'auto';

                if (NEGATIVE_MARKING_ENABLED === 'auto') {
                    NEGATIVE_MARKING_ENABLED = Math.random() < 0.5;
                }

                if (NEGATIVE_MARKING_ENABLED) {
                    const negativeMarkingValue = getRandomNumber(0.5 * 10, 2.0 * 10) / 10;
                    const warningElement = document.getElementById('negative-marking-warning');
                    warningElement.textContent = `Negative marking is enabled. Each incorrect answer will deduct ${negativeMarkingValue} points.`;
                    warningElement.style.display = 'block';
                }

                if (urlpart3 !== 'placements') return console.log('Placements page');

                let score = 0;
                const answeredQuestions = new Set();
                const attempts = {};
                let timerInterval;
                let startTime;
                const totalQuestions = getRandomNumber(MIN_QUESTIONS, MAX_QUESTIONS);
                const name = getUserName();

                document.getElementById(NAME_CONTAINER_ID).textContent = `${name}`;

                function getUserName() {
                    let name = localStorage.getItem('userName');
                    if (!name) {
                        name = prompt('Please enter your name:');
                        if (name) {
                            localStorage.setItem('userName', name);
                        }
                    }
                    return name || 'Guest';
                }

                function getRandomNumber(min, max) {
                    return Math.floor(Math.random() * (max - min + 1)) + min;
                }

                function calculateTimePerQuestion() {
                    const randomTimePerQuestion = getRandomNumber(MIN_TIME_PER_QUESTION, MAX_TIME_PER_QUESTION);
                    return totalQuestions * randomTimePerQuestion;
                }

                async function fetchQuestions() {
                    try {
                        const response = await fetch('qb.txt');
                        if (!response.ok) throw new Error('Network response was not ok');
                        const data = await response.text();
                        const questions = parseQuestions(data);
                        const selectedQuestions = getRandomQuestions(questions, totalQuestions);
                        displayQuestions(selectedQuestions);
                        const totalTime = calculateTimePerQuestion();
                        startTimer(totalTime);
                        startTime = new Date();
                    } catch (error) {
                        console.error('Error fetching the questions:', error);
                    }
                }

                function parseQuestions(data) {
                    const lines = data.split('\n');
                    let questions = [];
                    let currentQuestion = null;

                    lines.forEach(line => {
                        line = line.trim();
                        if (line.startsWith('ANSWER:')) {
                            if (currentQuestion) {
                                currentQuestion.answer = line.split(' ')[1];
                                questions.push(currentQuestion);
                                currentQuestion = null;
                            }
                        } else if (currentQuestion) {
                            currentQuestion.options.push(line);
                        } else {
                            currentQuestion = { question: line, options: [] };
                        }
                    });

                    return questions;
                }

                function getRandomQuestions(questions, count) {
                    const shuffled = questions.sort(() => 0.5 - Math.random());
                    return shuffled.slice(0, count);
                }

                function displayQuestions(questions) {
                    const questionsContainer = document.getElementById(QUESTIONS_CONTAINER_ID);
                    questionsContainer.innerHTML = '';

                    questions.forEach((question, index) => {
                        const col = document.createElement('div');
                        col.className = 'col';
                        col.innerHTML = `
                        <div class="card">
                            <div class="card-header">${question.question}</div>
                            <div class="card-body" data-index="${index}">
                                ${question.options.map((option, i) => `
                                    <div class="option" data-option="${String.fromCharCode(65 + i)}">${option}</div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                        questionsContainer.appendChild(col);
                    });

                    document.querySelectorAll('.option').forEach(option => {
                        option.addEventListener('click', handleOptionClick);
                    });
                }

                function handleOptionClick(event) {
                    const selectedOption = event.target;
                    const cardBody = selectedOption.closest('.card-body');
                    const questionIndex = cardBody.getAttribute('data-index');
                    const selectedAnswer = selectedOption.getAttribute('data-option');

                    if (answeredQuestions.has(questionIndex)) return;

                    answeredQuestions.add(questionIndex);
                    attempts[questionIndex] = selectedAnswer;

                    const question = questions[questionIndex];
                    const isCorrect = selectedAnswer === question.answer;

                    if (isCorrect) {
                        score++;
                        updateScore();
                    } else if (NEGATIVE_MARKING_ENABLED) {
                        score -= negativeMarkingValue;
                        updateScore();
                    }

                    selectedOption.classList.add(isCorrect ? 'correct' : 'incorrect');
                    cardBody.classList.add('disabled');
                }

                function updateScore() {
                    document.getElementById(SCORE_CONTAINER_ID).textContent = `${score}/${answeredQuestions.size}`;
                }

                function startTimer(totalTime) {
                    const timerElement = document.getElementById(TIMER_ELEMENT_ID);
                    let timeLeft = totalTime;

                    timerElement.textContent = `${timeLeft} seconds left`;

                    timerInterval = setInterval(() => {
                        timeLeft--;
                        timerElement.textContent = `${timeLeft} seconds left`;

                        if (timeLeft <= 0) {
                            clearInterval(timerInterval);
                            endQuiz();
                        }
                    }, 1000);
                }

                function endQuiz() {
                    const endTime = new Date();
                    const timeTaken = Math.floor((endTime - startTime) / 1000);
                    const congratsMessage = `Well done, ${name}! You completed the quiz.`;

                    document.getElementById(FINAL_SCORE_ID).textContent = `Final Score: ${score}/${totalQuestions}`;
                    document.getElementById(CONGRATS_MESSAGE_ID).textContent = congratsMessage;
                    document.getElementById(TIME_TAKEN_ID).textContent = `Time Taken: ${timeTaken} seconds`;

                    const endModal = new bootstrap.Modal(document.getElementById(END_MODAL_ID), {});
                    endModal.show();

                    setTimeout(() => {
                        location.reload();
                    }, 15000);
                }

                fetchQuestions();
            })();
        </script>
    </body>

</html>
