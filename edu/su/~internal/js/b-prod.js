let absenteeData = []; const urlParams = new URLSearchParams(window.location.search), subjectCode = urlParams.get("subject") || "CSUXXXX"; function showMessage(e, t) { document.getElementById("messageBox").innerHTML = `<div class="alert alert-${e}" role="alert">${t}</div>` } function loadAbsentees() { fetch("https://dmj.one/api/attendance/?view_absentees=true").then((e => e.json())).then((e => { const t = document.getElementById("absentees"), n = document.getElementById("name-container"); if (absenteeData = e.results || [], t.innerHTML = "", absenteeData.length > 0) { document.getElementById("absenteeblock").classList.remove("d-none"), document.getElementById("attendanceFormBlock").classList.toggle("d-none"), document.getElementById("helpnote").classList.toggle("d-none"); try { n.classList.remove("page-center", "flex-column"), document.getElementById("customcontent-kajdio479eaugd371u2").innerHTML = "" } catch (e) { } absenteeData.forEach((e => { const n = document.createElement("li"); n.textContent = `${e.name} (${e.roll})`, n.classList.add("list-group-item"), t.appendChild(n) })) } else t.innerHTML = '<li class="list-group-item text-danger fw-bold fs-4"><i class="bi bi-lock"></i> Portal Locked!</li>', n.classList.add("page-center", "flex-column"), n.innerHTML += '\n                <div id="customcontent-kajdio479eaugd371u2">\n                    <div class="d-flex justify-content-center align-items-center my-3">\n                      <div class="text-center p-4">\n                        <i class="bi bi-lock-fill display-1 text-danger"></i>\n                        <h1 class="mt-3 fw-bold text-primary">Portal Locked!</h1>\n                        <p class="text-muted mt-2 d-none">Please come back and refresh in 2 minutes.</p>                        \n                      </div>\n                    </div>\n                </div>\n                ' })).catch((e => { showMessage("danger", "Error loading absentees list: " + e), console.error("Error:", e) })) } function copyAbsenteesToClipboard() { const e = (new Date).toLocaleString("en-US", { year: "numeric", month: "long", day: "numeric", hour: "2-digit", minute: "2-digit" }), t = absenteeData.map((e => `- ${e.name} _${e.roll}_`)).join("\n"), n = absenteeData.length; let s = `Dear Professor,\n\nI hope this message finds you well. Please find the absentee list taken through semi-automatic attendance system https://go.dmj.one/self-checkin for *${subjectCode}* on *${e}* below:\n\n` + t + `\n\n> Total Present: *${68 - n}*\n> Total Absent: *${n}*\n\nKindly let me know if further details are needed.\n\nThank you. 🙏\nDivya Mohan\n_Make the world yours at_ *dmj.one*\nStudent/CR - CSE 2026\nShoolini University, 🇮🇳`; navigator.clipboard.writeText(s).then((() => { showMessage("success", "Absentees list successfully copied to clipboard.") }), (e => { showMessage("danger", "Failed to copy absentees list: " + e), console.error("Failed to copy text: ", e) })) } function checkUserEmail() { const e = localStorage.getItem("userEmail")?.toLowerCase(), t = atob("ZGl2eWFtb2hhbjE5OTNAZ21haWwuY29t"); if (["copyAbsenteesButton", "takeattendance", "simulate", "allabsent", "allpresent", "lockportal"].forEach((n => { document.getElementById(n).style.display = e === t ? "block" : "none" })), e === t) { document.getElementById("attendanceoptions").classList.toggle("d-none"), document.getElementById("attendanceAccordion").classList.toggle("d-none"); const e = { takeattendance: { take_attendance: "true" }, simulate: { simulate: "true" }, allabsent: { all_absent: "true" }, allpresent: { all_present: "true" }, lockportal: { lock_portal: "true" } }; Object.keys(e).forEach((t => { document.getElementById(t).addEventListener("click", (() => function (e) { const t = new URL("https://dmj.one/api/attendance/"); Object.entries(e).forEach((([e, n]) => t.searchParams.append(e, n))), fetch(t).then((e => e.text())).then((e => { showMessage("success", e), loadAbsentees() })).catch((e => { showMessage("danger", "Error: " + e), console.error("Error:", e) })) }(e[t]))) })) } } function controlVisibility() { const e = localStorage.getItem("userEmail")?.toLowerCase(), t = [atob("ZGl2eWFtb2hhbjE5OTNAZ21haWwuY29t")]; if (console.log("inside"), t.includes(e)) { const e = document.querySelector("main"); e && (e.classList.remove("d-none"), e.style.display = "block") } else { const e = document.querySelector("main"); e && (e.innerHTML = '<div class="text-danger text-center display-1 page-center justify-content-center">401: Unauthorized</div>', e.classList.remove("d-none"), e.style.display = "block") } } document.getElementById("termsCheckbox").addEventListener("change", (function () { const e = this.parentElement; this.checked ? (e.classList.add("bg-success", "bg-opacity-25"), e.classList.remove("bg-auto")) : (e.classList.remove("bg-success", "bg-opacity-25"), e.classList.add("bg-auto")) })), document.getElementById("attendanceForm").addEventListener("submit", (function (e) { e.preventDefault(); const t = document.getElementById("rollInput").value, n = localStorage.getItem("userEmail"), s = document.getElementById("termsCheckbox").checked, o = (new Date).toISOString(); n ? s ? fetch(`https://dmj.one/api/attendance/?userRoll=${encodeURIComponent(t)}&userEmail=${encodeURIComponent(n)}&userTime=${encodeURIComponent(o)}`).then((e => e.text())).then((e => { showMessage("success", e), loadAbsentees() })).catch((e => { showMessage("danger", "Error: " + e), console.error("Error:", e) })) : showMessage("danger", "You must agree to the terms to mark attendance.") : showMessage("danger", "You must be logged in to mark attendance.") })), document.getElementById("copyAbsenteesButton").addEventListener("click", copyAbsenteesToClipboard), document.addEventListener("DOMContentLoaded", (function () { controlVisibility(), checkUserEmail(), loadAbsentees(), cL() }));