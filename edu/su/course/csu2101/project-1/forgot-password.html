<!DOCTYPE html>
<html lang="en" data-bs-theme="auto">

    <head>
        <meta charset="UTF-8">
        <title>Forgot Password Reset - CourseConnect</title>

        <!-- Open Graph / Twitter metadata -->
        <meta property="og:image" content="/logo.png">
        <meta property="og:type" content="article">
        <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@yourTwitterHandle">
        <meta name="twitter:creator" content="@yourTwitterHandle">
        <meta name="twitter:image" content="/logo.png">

        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="author" content="Your Name">
        <meta name="robots" content="noindex, nofollow">

        <!-- Prevent caching -->
        <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
        <meta http-equiv="Pragma" content="no-cache" />
        <meta http-equiv="Expires" content="0" />

        <!-- Bootstrap CSS -->
        <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">

        <style>
            body {
                margin: 0;
                padding: 0;
                position: relative;                
            }

            /* Background image with blur */
            body::before {
                content: "";
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: url('https://agen-bgimg.dmj.one/') no-repeat center center fixed;
                background-size: cover;
                filter: blur(10px);
                z-index: -1;
            }

            /* Card styling */
            .card {
                background-color: rgba(255, 255, 255, 0.92);
                border: none;
                border-radius: 10px;
            }

            .nav-tabs .nav-link {
                border: none;
                border-bottom: 2px solid transparent;
            }

            .nav-tabs .nav-link.active {
                border-color: #0d6efd;
            }
        </style>

        <script>
            (function () {
                'use strict';
                const defaultTheme = 'light';
                let storedTheme;
                try {
                    storedTheme = localStorage.getItem('theme');
                } catch (err) { }
                if (storedTheme === 'dark' || (!storedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                    document.documentElement.setAttribute('data-bs-theme', 'dark');
                } else {
                    document.documentElement.setAttribute('data-bs-theme', defaultTheme);
                }
            })();
        </script>
    </head>

    <body>
        <div class="container py-5">
            <div class="row justify-content-center">
                <div class="col-md-6 col-lg-5">
                    <div class="card shadow-lg">
                        <div class="card-body">
                            <h3 class="card-title text-center mb-4">Forgot Password</h3>
                            <!-- Nav tabs -->
                            <ul class="nav nav-tabs mb-3" id="resetTab" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="request-tab" data-bs-toggle="tab" data-bs-target="#request" type="button" role="tab" aria-controls="request" aria-selected="true">
                                        Request Reset
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="reset-tab" data-bs-toggle="tab" data-bs-target="#reset" type="button" role="tab" aria-controls="reset" aria-selected="false">
                                        Reset Password
                                    </button>
                                </li>
                            </ul>
                            <!-- Tab content -->
                            <div class="tab-content" id="resetTabContent">
                                <!-- Request Reset Form -->
                                <div class="tab-pane fade show active" id="request" role="tabpanel" aria-labelledby="request-tab">
                                    <form id="reset-request-form">
                                        <div class="mb-3">
                                            <label for="request-email" class="form-label">Email Address</label>
                                            <input type="email" class="form-control" id="request-email" placeholder="you@example.com" required>
                                        </div>
                                        <button type="submit" class="btn btn-primary w-100">Request Reset</button>
                                    </form>
                                    <div id="reset-request-message" class="mt-3"></div>
                                </div>
                                <!-- Reset Password Form -->
                                <div class="tab-pane fade" id="reset" role="tabpanel" aria-labelledby="reset-tab">
                                    <form id="reset-form">
                                        <div class="mb-3">
                                            <label for="reset-token" class="form-label">Reset Token</label>
                                            <input type="text" class="form-control" id="reset-token" placeholder="Enter reset token" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="new-password" class="form-label">New Password</label>
                                            <input type="password" class="form-control" id="new-password" placeholder="New password" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="confirm-password" class="form-label">Confirm New Password</label>
                                            <input type="password" class="form-control" id="confirm-password" placeholder="Confirm new password" required>
                                        </div>
                                        <button type="submit" class="btn btn-success w-100">Reset Password</button>
                                    </form>
                                    <div id="reset-message" class="mt-3"></div>
                                </div>
                            </div>
                            <div class="text-center mt-3">
                                <a href="login">Back to Login</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bootstrap Bundle and FontAwesome -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
        <script>
            // Handle the "Request Reset" form submission
            document.getElementById('reset-request-form').addEventListener('submit', async function (e) {
                e.preventDefault();
                const email = document.getElementById('request-email').value.trim();
                const messageDiv = document.getElementById('reset-request-message');
                messageDiv.innerHTML = '<div class="alert alert-info">Processing your request...</div>';
                try {
                    const response = await fetch('api/reset-request', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email })
                    });
                    const data = await response.json();
                    if (response.ok) {
                        messageDiv.innerHTML = '<div class="alert alert-success">Reset request successful. Please check your email for further instructions.</div>';
                    } else {
                        messageDiv.innerHTML = '<div class="alert alert-danger">' + (data.error || 'An error occurred.') + '</div>';
                    }
                } catch (error) {
                    messageDiv.innerHTML = '<div class="alert alert-danger">Error: ' + error.message + '</div>';
                }
            });

            // Handle the "Reset Password" form submission
            document.getElementById('reset-form').addEventListener('submit', async function (e) {
                e.preventDefault();
                const token = document.getElementById('reset-token').value.trim();
                const newPassword = document.getElementById('new-password').value;
                const confirmPassword = document.getElementById('confirm-password').value;
                const messageDiv = document.getElementById('reset-message');
                if (newPassword !== confirmPassword) {
                    messageDiv.innerHTML = '<div class="alert alert-danger">Passwords do not match.</div>';
                    return;
                }
                messageDiv.innerHTML = '<div class="alert alert-info">Processing password reset...</div>';
                try {
                    const response = await fetch('api/reset', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ token, newPassword })
                    });
                    const data = await response.json();
                    if (response.ok) {
                        messageDiv.innerHTML = '<div class="alert alert-success">Password reset successful. You can now log in with your new password.</div>';
                    } else {
                        messageDiv.innerHTML = '<div class="alert alert-danger">' + (data.error || 'An error occurred.') + '</div>';
                    }
                } catch (error) {
                    messageDiv.innerHTML = '<div class="alert alert-danger">Error: ' + error.message + '</div>';
                }
            });
        </script>
    </body>

</html>