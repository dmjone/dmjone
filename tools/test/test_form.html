<!-------------------------- Â© 2007 - present, dmj.one and contributors. ----------------------------------
   Part of the dmjone project. Licensed under the GNU AGPL. Provided as-is, without warranty of any kind. 
-------------------- Redistribution and modifications must retain this notice. --------------------------->


<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.3/css/bootstrap.min.css" integrity="sha512-SbiR/eusphKoMVVXysTKG/7VseWii+Y3FdHrt0EpKgpToZeemhqHeZeLWLhJutz/2ut2Vw1uQEj2MbRF+TVBUA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.3/font/bootstrap-icons.min.css" integrity="sha512-YFENbnqHbCRmJt5d+9lHimyEMt8LKSNTMLSaHjvsclnZGICeY/0KYEeiHwD1Ux4Tcao0h60tdcMv+0GljvWyHg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
        <link rel="stylesheet" href="/css/edu_su_common.css" />
        <link rel="shortcut icon" href="/logo.png">

        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js" integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

        <title>Document</title>
    </head>

    <body class="container">
        <button type="button" class="btn bg-gradient bg-warning bg-opacity-10 position-fixed" style="right: 0px; bottom: 30%;" data-bs-toggle="modal" data-bs-target="#contactModal"><i class="bi bi-envelope-plus-fill"></i></button>

        <div class="modal fade" id="contactModal" tabindex="-1" aria-labelledby="contactModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="contactModalLabel">Message Us</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="container">
                            <div id="form-container">
                                <form id="contact-form" class="mt-4">
                                    <div class="mb-3">
                                        <label for="name" class="form-label">Name*</label>
                                        <input type="text" class="form-control" id="name" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="email" class="form-label">Email*</label>
                                        <input type="email" class="form-control" id="email" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="message-type" class="form-label">Message Type*</label>
                                        <select class="form-select" id="message-type" required>
                                            <option selected disabled value="">Choose...</option>
                                            <option value="query">Query</option>
                                            <option value="question">Question</option>
                                            <option value="idea">Idea</option>
                                            <option value="general">General</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="message" class="form-label">Message*</label>
                                        <textarea class="form-control" id="message" required></textarea>
                                    </div>
                                    <div class="d-flex justify-content-center mb-3">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="anonymousSwitch">
                                            <label class="form-check-label" for="anonymousSwitch">Send Anonymously</label>
                                        </div>
                                    </div>
                                    <div class="d-grid gap-2">
                                        <button type="submit" class="btn btn-primary" id="submit-button" disabled>Submit</button>
                                    </div>
                                </form>
                            </div>

                            <div id="success-message" class="alert alert-success mt-4" role="alert" style="display: none;">
                                Your message was submitted successfully.
                            </div>

                            <div id="error-message" class="alert alert-danger mt-4" role="alert" style="display: none;">
                                There was an error submitting your message.
                            </div>
                        </div>
                    </div>

                    <!-- <div class="modal-body">
                        <div id="form-container">
                            <form id="contact-form" class="needs-validation" novalidate>

                                <div class="mb-3 form-check">
                                    <input type="checkbox" class="form-check-input" id="anonymous" onchange="toggleAnonymous()">
                                    <label class="form-check-label" for="anonymous">Send Anonymously</label>
                                </div>

                                <div id="name-field" class="mb-3">
                                    <label for="name" class="form-label">Your name</label>
                                    <input type="text" class="form-control" id="name" name="name" placeholder="Your name" required>
                                    <div class="valid-feedback">Looks good!</div>
                                    <div class="invalid-feedback">Please enter your name.</div>
                                </div>
                                <div id="email-field" class="mb-3">
                                    <label for="email" class="form-label">Your email</label>
                                    <input type="email" class="form-control" id="email" name="email" placeholder="Your email" required>
                                    <div class="valid-feedback">Looks good!</div>
                                    <div class="invalid-feedback">Please enter your email.</div>
                                </div>

                                <div id="message-type-field" class="mb-3">
                                    <label for="message-type" class="form-label">Message Type</label>
                                    <select class="form-select" id="message-type" required>
                                        <option selected disabled value="">Choose...</option>
                                        <option value="query">Query</option>
                                        <option value="question">Question</option>
                                        <option value="suggestion">Suggestion</option>
                                        <option value="feedback">Feedback</option>
                                        <option value="problem">Problem</option>
                                        <option value="other">Other</option>
                                    </select>
                                    <div class="invalid-feedback">Please select a message type.</div>
                                </div>

                                <div id="message-field" class="mb-3">
                                    <label for="message" class="form-label">Your message</label>
                                    <textarea id="message" name="message" class="form-control" placeholder="Your message" required></textarea>
                                    <div class="valid-feedback">Looks good!</div>
                                    <div class="invalid-feedback">Please enter your message.</div>
                                </div>

                                <div id="submit-message" class="mb-3 text-danger" style="display: none;">Please select a message type and enter a message to submit.</div>
                                <div id="submit-message-noanon" class="mb-3 text-danger">Please enter all fields to submit.</div>

                                <button id="submit-button" type="submit" class="btn btn-primary" disabled>Submit</button>
                            </form>
                        </div>

                        <div id="success-message" class="alert alert-success" role="alert" style="display: none;">
                            Your message was submitted successfully.
                        </div>

                        <div id="error-message" class="alert alert-danger" role="alert" style="display: none;">
                            There was an error submitting your message.
                        </div>
                    </div> -->
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <script>

            const messageTypeElement = document.getElementById('message-type')
            const messageElement = document.getElementById('message')
            const submitButton = document.getElementById('submit-button')
            const submitMessage = document.getElementById('submit-message')
            const submsgnoanon = document.getElementById('submit-message-noanon')
            const nameElement = document.getElementById('name')
            const emailElement = document.getElementById('email')
            let anonmode = 0

            function toggleAnonymous() {

                // const anonymousElement = document.getElementById('anonymous')
                const anonymousElement = document.getElementById('anonymousSwitch');
                const nameField = document.getElementById('name-field')
                const emailField = document.getElementById('email-field')

                if (anonymousElement.checked) {
                    nameField.style.display = 'none'
                    emailField.style.display = 'none'
                    submitMessage.style.display = 'block'
                    submsgnoanon.style.display = 'none'
                    anonmode = 1
                } else {
                    nameField.style.display = 'block'
                    emailField.style.display = 'block'
                    submitMessage.style.display = 'none'
                    submsgnoanon.style.display = 'block'
                    anonmode = 0
                }
                return anonmode;
            }

            function checkForm() {
                const nameElement = document.getElementById('name')
                const emailElement = document.getElementById('email')
                if (anonmode === 1) {
                    if (messageTypeElement.value !== "" && messageElement.value.trim() !== "") {
                        submitButton.disabled = false
                        submitMessage.style.display = 'none'
                    } else {
                        submitButton.disabled = true
                        submitMessage.style.display = 'block'
                    }
                } else {
                    if (nameElement.value.trim() !== '' && emailElement.value.trim() !== '' && messageTypeElement.value !== '' && messageElement.value.trim() !== '') {
                        submitButton.disabled = false
                        submsgnoanon.style.display = 'none'
                    } else {
                        submitButton.disabled = true
                        submsgnoanon.style.display = 'block'
                    }
                }
            }


            messageTypeElement.addEventListener('change', checkForm)
            messageElement.addEventListener('input', checkForm)

            document.getElementById('contact-form').addEventListener('submit', async function (e) {
                e.preventDefault()

                document.getElementById('submit-button').disabled = true

                const formContainer = document.getElementById('form-container')
                const successMessage = document.getElementById('success-message')
                const errorMessage = document.getElementById('error-message')
                const contactModal = document.getElementById('contactModal')

                const nameElement = document.getElementById('name')
                const emailElement = document.getElementById('email')
                const messageElement = document.getElementById('message')
                const messageTypeElement = document.getElementById('message-type')
                // const anonymousElement = document.getElementById('anonymous')
                const anonymousElement = document.getElementById('anonymousSwitch');


                let name = ''
                let email = ''

                if (!anonymousElement.checked) {
                    name = nameElement.value
                    email = emailElement.value
                }

                const message = messageElement.value
                const messageType = messageTypeElement.value

                if (messageTypeElement.value === '' || messageElement.value.trim() === '') {
                    console.error('Error: Message type and message cannot be empty')
                    return
                }

                try {
                    const response = await fetch('https://submit.dmj.one', {
                        method: 'POST',
                        headers: {
                            'content-type': 'application/json'
                        },
                        body: JSON.stringify({ name, email, message, messageType })
                    })

                    if (response.ok) {
                        formContainer.style.display = 'none'
                        successMessage.style.display = 'block'

                        setTimeout(() => {
                            var bootstrapModal = bootstrap.Modal.getInstance(contactModal)
                            bootstrapModal.hide()
                        }, 2000)

                        setTimeout(() => {
                            successMessage.style.display = 'none'
                            formContainer.style.display = 'block'
                            e.target.reset()
                            toggleAnonymous()
                            checkForm() // Call the function to disable the submit button and show the message to the user
                        }, 3000)
                    } else {
                        errorMessage.style.display = 'block'
                        setTimeout(() => {
                            errorMessage.style.display = 'none'
                        }, 2000)
                    }
                } catch (error) {
                    errorMessage.style.display = 'block'
                    setTimeout(() => {
                        errorMessage.style.display = 'none'
                    }, 2000)
                }

                // const response = await fetch('https://submit.dmj.one', {
                //     method: 'POST',
                //     headers: {
                //         'content-type': 'application/json'
                //     },
                //     body: JSON.stringify({ name, email, message, messageType })
                // })

                // document.getElementById('spinner').style.display = 'none'
                // document.getElementById('submit-button').disabled = false

                // if (response.ok) {
                //     console.log('Form submitted successfully')
                //     document.getElementById('checkmark').style.display = 'inline-block'
                //     setTimeout(() => {
                //         document.getElementById('checkmark').style.display = 'none'
                //     }, 3000)

                //     // Clear form fields
                //     nameElement.value = ''
                //     emailElement.value = ''
                //     messageElement.value = ''
                //     messageTypeElement.value = 'query'
                //     anonymousElement.checked = false
                // } else {
                //     console.error('Error submitting form')
                // }


            });
        </script>


        <!-- // VER 1.0 
            <form id="contact-form">
            <input type="text" id="name" name="name" placeholder="Your name">
            <select id="message-type">
                <option value="query">Query</option>
                <option value="question">Question</option>
                <option value="idea">Idea</option>
                <option value="general">General</option>
            </select>
            <input type="email" id="email" name="email" placeholder="Your email">
            <textarea id="message" name="message" placeholder="Your message"></textarea>
            <button type="submit">Submit</button>
        </form>

        <script>
            document.getElementById('contact-form').addEventListener('submit', async function (e) {
                    e.preventDefault()

                    const name = document.getElementById('name').value || 'Anonymous'
                    const email = document.getElementById('email').value
                    const message = document.getElementById('message').value
                    const messageType = document.getElementById('message-type').value

                    const response = await fetch('https://submit.dmj.one', {
                        method: 'POST',
                        headers: {
                            'content-type': 'application/json'
                        },
                        body: JSON.stringify({ name, email, message, messageType })
                    })

                    if (response.ok) {
                        console.log('Form submitted successfully')
                    } else {
                        console.error('Error submitting form')
                    }
                });
        </script> -->

        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js" integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.3/js/bootstrap.bundle.min.js" integrity="sha512-i9cEfJwUwViEPFKdC1enz4ZRGBj8YQo6QByFTF92YXHi7waCqyexvRD75S5NVTsSiTv7rKWqG9Y5eFxmRsOn0A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    </body>

</html>
