<!doctype html>
<html lang="en">

    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>Line Diff — Paste & Compare</title>
        <style>
            :root {
                --bg: #ffffff;
                --text: #1f2328;
                --muted: #57606a;
                --border: #d0d7de;
                --focus: #0969da;

                --add-bg: #e6ffed;
                --add-br: #2ea043;

                --del-bg: #ffebe9;
                --del-br: #d1242f;

                --mod-bg: #fff9db;
                --mod-br: #9a6700;

                --token-ins: #acf2bd;
                --token-del: #ffdce0;

                --radius: 10px;
                --ln-width: 6ch;
                --mono: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
                --sans: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", sans-serif;
            }

            @media (prefers-color-scheme: dark) {
                :root {
                    --bg: #0d1117;
                    --text: #e6edf3;
                    --muted: #8b949e;
                    --border: #30363d;
                    --focus: #2f81f7;

                    --add-bg: #0e4429;
                    --add-br: #56d364;

                    --del-bg: #3c1e23;
                    --del-br: #ff7b72;

                    --mod-bg: #3b2e06;
                    --mod-br: #e3b341;

                    --token-ins: #16472b;
                    --token-del: #5b1a1a;
                }
            }

            * {
                box-sizing: border-box
            }

            body {
                margin: 0;
                font: 16px/1.5 var(--sans);
                color: var(--text);
                background: var(--bg);
            }

            .container {
                max-width: 1100px;
                margin: 24px auto;
                padding: 0 16px;
            }

            header h1 {
                margin: 0 0 6px 0;
                font-size: clamp(22px, 3vw, 28px);
            }

            header p {
                margin: 0;
                color: var(--muted)
            }

            .inputs {
                margin-top: 16px;
                display: grid;
                gap: 12px;
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }

            @media (max-width: 820px) {
                .inputs {
                    grid-template-columns: 1fr
                }
            }

            .box label {
                display: flex;
                align-items: center;
                justify-content: space-between;
                font-weight: 600;
                margin-bottom: 6px;
            }

            textarea {
                width: 100%;
                min-height: 220px;
                resize: vertical;
                padding: 12px 12px;
                border: 1px solid var(--border);
                border-radius: var(--radius);
                font: 14px/1.4 var(--mono);
                background: var(--bg);
                color: var(--text);
            }

            textarea:focus {
                outline: 3px solid color-mix(in oklab, var(--focus) 35%, transparent)
            }

            .controls {
                margin-top: 12px;
                display: flex;
                flex-wrap: wrap;
                gap: 8px 12px;
                align-items: center;
            }

            button,
            .seg input[type="checkbox"]+span {
                font: inherit;
                cursor: pointer;
            }

            button {
                padding: 8px 12px;
                border: 1px solid var(--border);
                border-radius: 8px;
                background: #f6f8fa;
                color: #24292f;
            }

            @media (prefers-color-scheme: dark) {
                button {
                    background: #161b22;
                    color: var(--text);
                    border-color: var(--border);
                }
            }

            button.primary {
                border-color: var(--focus);
                background: color-mix(in oklab, var(--focus) 14%, transparent);
            }

            button:focus-visible {
                outline: 3px solid color-mix(in oklab, var(--focus) 40%, transparent)
            }

            .options {
                display: flex;
                gap: 16px;
                align-items: center;
                color: var(--muted);
            }

            .options label {
                display: flex;
                align-items: center;
                gap: 6px;
                user-select: none;
            }

            .legend {
                display: flex;
                gap: 16px;
                align-items: center;
                margin-top: 10px;
                color: var(--muted);
                flex-wrap: wrap;
            }

            .chip {
                display: inline-flex;
                align-items: center;
                gap: 8px;
                padding: 6px 10px;
                border-radius: 999px;
                border: 1px solid var(--border);
                font-size: 13px;
                background: #f6f8fa;
            }

            @media (prefers-color-scheme: dark) {
                .chip {
                    background: #161b22
                }
            }

            .chip .swatch {
                width: 14px;
                height: 14px;
                border-radius: 4px;
                border: 2px solid transparent
            }

            .chip.add .swatch {
                background: var(--add-bg);
                border-color: var(--add-br)
            }

            .chip.del .swatch {
                background: var(--del-bg);
                border-color: var(--del-br)
            }

            .chip.mod .swatch {
                background: var(--mod-bg);
                border-color: var(--mod-br)
            }

            .stats {
                margin-top: 10px;
                color: var(--muted)
            }

            .results {
                margin-top: 14px;
                border: 1px solid var(--border);
                border-radius: var(--radius);
                overflow: hidden;
            }

            table.diff {
                width: 100%;
                border-collapse: separate;
                border-spacing: 0
            }

            thead th {
                text-align: left;
                font-size: 13px;
                color: var(--muted);
                background: #f6f8fa;
                border-bottom: 1px solid var(--border);
                position: sticky;
                top: 0;
                z-index: 1;
                padding: 8px 10px;
            }

            @media (prefers-color-scheme: dark) {
                thead th {
                    background: #0b0f14
                }
            }

            tbody td {
                vertical-align: top;
                padding: 6px 10px;
                border-bottom: 1px solid color-mix(in oklab, var(--border) 70%, transparent)
            }

            td.sym {
                width: 3ch;
                text-align: center;
                font-weight: 700;
                font-family: var(--mono);
            }

            td.ln {
                width: var(--ln-width);
                font-family: var(--mono);
                color: var(--muted);
                text-align: right;
                padding-right: 12px;
                border-right: 1px dashed color-mix(in oklab, var(--border) 60%, transparent);
            }

            td.text {
                font-family: var(--mono);
                white-space: pre-wrap;
                word-break: break-word;
            }

            /* Row colors / borders */
            tr.add td.text {
                background: var(--add-bg);
                border-left: 4px solid var(--add-br)
            }

            tr.del td.text {
                background: var(--del-bg);
                border-left: 4px solid var(--del-br)
            }

            tr.mod-old td.text {
                background: var(--mod-bg);
                border-left: 4px solid var(--mod-br)
            }

            tr.mod-new td.text {
                background: var(--mod-bg);
                border-left: 4px solid var(--mod-br)
            }

            /* Inline token highlights inside modified lines */
            .token-ins {
                background: var(--token-ins);
                border-radius: 4px;
                padding: 0 .12em
            }

            .token-del {
                background: var(--token-del);
                border-radius: 4px;
                padding: 0 .12em;
                text-decoration: line-through;
                text-decoration-thickness: .09em
            }

            /* Utility */
            .sr-only {
                position: absolute;
                width: 1px;
                height: 1px;
                padding: 0;
                margin: -1px;
                overflow: hidden;
                clip: rect(0, 0, 0, 0);
                white-space: nowrap;
                border: 0;
            }

            footer {
                color: var(--muted);
                font-size: 12px;
                margin: 16px 0 8px
            }
        </style>
    </head>

    <body>
        <div class="container">
            <header>
                <h1>Line Diff — Paste & Compare</h1>
                <p>Paste the original and the changed text. Then click <b>Compare</b> (or press <kbd>Ctrl/⌘ + Enter</kbd>).</p>
            </header>

            <section class="inputs" aria-label="Input texts">
                <div class="box">
                    <label for="orig">Original</label>
                    <textarea id="orig" placeholder="Paste original text here…"></textarea>
                </div>
                <div class="box">
                    <label for="changed">Changed</label>
                    <textarea id="changed" placeholder="Paste changed text here…"></textarea>
                </div>
            </section>

            <section class="controls" aria-label="Actions and options">
                <button id="compare" class="primary">Compare</button>
                <button id="swap" title="Swap original/changed">Swap</button>
                <button id="clear" title="Clear both boxes">Clear</button>

                <div class="options" role="group" aria-label="Comparison options">
                    <label title="Treat lines that only differ by whitespace as equal">
                        <input id="optWhitespace" type="checkbox" /> Ignore whitespace-only changes
                    </label>
                    <label title="Case-insensitive comparison">
                        <input id="optCase" type="checkbox" /> Ignore case
                    </label>
                </div>
            </section>

            <section class="legend" aria-label="Legend">
                <span class="chip add"><span class="swatch" aria-hidden="true"></span><strong>+</strong> Added</span>
                <span class="chip del"><span class="swatch" aria-hidden="true"></span><strong>−</strong> Deleted</span>
                <span class="chip mod"><span class="swatch" aria-hidden="true"></span><strong>~</strong> Modified (inline highlights)</span>
            </section>

            <div class="stats" id="stats" aria-live="polite"></div>

            <section class="results" aria-label="Diff results">
                <table class="diff" aria-describedby="stats">
                    <thead>
                        <tr>
                            <th class="sym" scope="col" title="Change symbol">Δ</th>
                            <th class="ln" scope="col">Old #</th>
                            <th class="ln" scope="col">New #</th>
                            <th class="text" scope="col">Line</th>
                        </tr>
                    </thead>
                    <tbody id="diffBody" aria-live="polite" aria-busy="false"></tbody>
                </table>
            </section>

            <footer>Keyboard: <kbd>Ctrl/⌘ + Enter</kbd> to compare. <kbd>Esc</kbd> to clear results focus.</footer>
        </div>

        <script>
            const el = {
                orig: document.getElementById('orig'),
                changed: document.getElementById('changed'),
                compare: document.getElementById('compare'),
                swap: document.getElementById('swap'),
                clear: document.getElementById('clear'),
                stats: document.getElementById('stats'),
                body: document.getElementById('diffBody'),
                optWhitespace: document.getElementById('optWhitespace'),
                optCase: document.getElementById('optCase'),
            };

            function escapeHtml(s) {
                return s.replace(/[&<>"]/g, ch => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;' }[ch]));
            }

            function normalizeLine(s, { ignoreWhitespace, ignoreCase }) {
                let t = s;
                if (ignoreWhitespace) t = t.replace(/\s+/g, ' ').trimEnd();
                if (ignoreCase) t = t.toLowerCase();
                return t;
            }

            function splitLines(text) {
                // Keep trailing empty line if present
                return text.replace(/\r\n?/g, '\n').split('\n');
            }

            /**
             * LCS diff (arrays) — returns ops of {type:'equal'|'delete'|'insert', aIndex, bIndex}
             * Optimized by trimming common prefix/suffix to reduce DP size.
             */
            function lcsDiffArray(a, b) {
                const n = a.length, m = b.length;
                let start = 0;
                while (start < n && start < m && a[start] === b[start]) start++;
                let endA = n - 1, endB = m - 1;
                while (endA >= start && endB >= start && a[endA] === b[endB]) { endA--; endB--; }

                const ops = [];
                for (let i = 0; i < start; i++) ops.push({ type: 'equal', aIndex: i, bIndex: i });

                // Middle section DP
                const nMid = endA - start + 1, mMid = endB - start + 1;
                if (nMid > 0 || mMid > 0) {
                    if (nMid === 0) {
                        for (let j = 0; j < mMid; j++) ops.push({ type: 'insert', aIndex: start, bIndex: start + j });
                    } else if (mMid === 0) {
                        for (let i = 0; i < nMid; i++) ops.push({ type: 'delete', aIndex: start + i, bIndex: start });
                    } else {
                        const dp = Array(nMid + 1);
                        for (let i = 0; i <= nMid; i++) dp[i] = new Array(mMid + 1).fill(0);
                        for (let i = 1; i <= nMid; i++) {
                            const ai = a[start + i - 1];
                            for (let j = 1; j <= mMid; j++) {
                                dp[i][j] = (ai === b[start + j - 1]) ? dp[i - 1][j - 1] + 1
                                    : (dp[i - 1][j] >= dp[i][j - 1] ? dp[i - 1][j] : dp[i][j - 1]);
                            }
                        }
                        // Backtrack
                        let i = nMid, j = mMid; const middle = [];
                        while (i > 0 && j > 0) {
                            if (a[start + i - 1] === b[start + j - 1]) {
                                middle.push({ type: 'equal', aIndex: start + i - 1, bIndex: start + j - 1 }); i--; j--;
                            } else if (dp[i - 1][j] >= dp[i][j - 1]) {
                                middle.push({ type: 'delete', aIndex: start + i - 1, bIndex: start + j }); i--;
                            } else {
                                middle.push({ type: 'insert', aIndex: start + i, bIndex: start + j - 1 }); j--;
                            }
                        }
                        while (i > 0) { middle.push({ type: 'delete', aIndex: start + i - 1, bIndex: start }); i--; }
                        while (j > 0) { middle.push({ type: 'insert', aIndex: start, bIndex: start + j - 1 }); j--; }
                        middle.reverse().forEach(op => ops.push(op));
                    }
                }
                // Suffix
                const suffix = Math.min(n - endA - 1, m - endB - 1);
                for (let k = 0; k < suffix; k++) {
                    const ai = n - suffix + k, bi = m - suffix + k;
                    ops.push({ type: 'equal', aIndex: ai, bIndex: bi });
                }
                return ops;
            }

            /** Tokenize for inline (word-level) diff; preserves whitespace as tokens */
            function tokenizeWords(s) {
                return s.split(/(\s+)/g); // keeps spaces as separate tokens
            }

            /** Word-level diff using LCS; returns [oldHtml, newHtml] with <span> highlights */
            function wordLevelDiffHtml(oldLine, newLine, opts) {
                const a = tokenizeWords(oldLine), b = tokenizeWords(newLine);
                // LCS on tokens (no trimming needed — lines are short)
                const n = a.length, m = b.length;
                const dp = Array(n + 1); for (let i = 0; i <= n; i++) dp[i] = new Array(m + 1).fill(0);
                for (let i = 1; i <= n; i++) {
                    for (let j = 1; j <= m; j++) {
                        dp[i][j] = (a[i - 1] === b[j - 1]) ? dp[i - 1][j - 1] + 1
                            : (dp[i - 1][j] >= dp[i][j - 1] ? dp[i - 1][j] : dp[i][j - 1]);
                    }
                }
                let i = n, j = m, ops = [];
                while (i > 0 && j > 0) {
                    if (a[i - 1] === b[j - 1]) { ops.push(['eq', a[i - 1], b[j - 1]]); i--; j--; }
                    else if (dp[i - 1][j] >= dp[i][j - 1]) { ops.push(['del', a[i - 1], '']); i--; }
                    else { ops.push(['ins', '', b[j - 1]]); j--; }
                }
                while (i > 0) { ops.push(['del', a[i - 1], '']); i--; }
                while (j > 0) { ops.push(['ins', '', b[j - 1]]); j--; }
                ops.reverse();

                let oldHtml = '', newHtml = '';
                for (const [t, av, bv] of ops) {
                    if (t === 'eq') { oldHtml += escapeHtml(av); newHtml += escapeHtml(bv); }
                    else if (t === 'del') { oldHtml += `<span class="token-del">${escapeHtml(av)}</span>`; }
                    else { newHtml += `<span class="token-ins">${escapeHtml(bv)}</span>`; }
                }
                return [oldHtml, newHtml];
            }

            /** Build unified rows with line numbers and inline highlights */
            function buildRows(ops, rawA, rawB, opts) {
                let iA = 0, iB = 0;
                let pendingDel = [], pendingIns = [];
                const rows = [];

                function flushPairing() {
                    const n = Math.min(pendingDel.length, pendingIns.length);
                    for (let k = 0; k < n; k++) {
                        const del = pendingDel[k], ins = pendingIns[k];
                        const [oldHtml, newHtml] = wordLevelDiffHtml(del.text, ins.text, opts);
                        rows.push({ kind: 'mod-old', sym: '~', aNo: del.no, bNo: '', html: oldHtml });
                        rows.push({ kind: 'mod-new', sym: '~', aNo: '', bNo: ins.no, html: newHtml });
                    }
                    for (let k = n; k < pendingDel.length; k++) {
                        const del = pendingDel[k];
                        rows.push({ kind: 'del', sym: '−', aNo: del.no, bNo: '', html: escapeHtml(del.text) });
                    }
                    for (let k = n; k < pendingIns.length; k++) {
                        const ins = pendingIns[k];
                        rows.push({ kind: 'add', sym: '+', aNo: '', bNo: ins.no, html: escapeHtml(ins.text) });
                    }
                    pendingDel = []; pendingIns = [];
                }

                for (const op of ops) {
                    if (op.type === 'equal') {
                        // equal lines: not shown in output, but we must flush any pending change block
                        flushPairing();
                        iA++; iB++;
                    } else if (op.type === 'delete') {
                        pendingDel.push({ no: iA + 1, text: rawA[iA] });
                        iA++;
                    } else if (op.type === 'insert') {
                        pendingIns.push({ no: iB + 1, text: rawB[iB] });
                        iB++;
                    }
                }
                flushPairing();
                return rows;
            }

            function renderRows(rows) {
                el.body.setAttribute('aria-busy', 'true');
                el.body.innerHTML = '';
                const frag = document.createDocumentFragment();
                let added = 0, deleted = 0, modifiedPairs = 0;
                let modOpen = false;

                for (const r of rows) {
                    const tr = document.createElement('tr');
                    tr.className = r.kind;

                    const tdSym = document.createElement('td'); tdSym.className = 'sym'; tdSym.textContent = r.sym;
                    tdSym.setAttribute('aria-label',
                        r.kind === 'add' ? 'Added' : r.kind === 'del' ? 'Deleted' : 'Modified');

                    const tdOld = document.createElement('td'); tdOld.className = 'ln';
                    const tdNew = document.createElement('td'); tdNew.className = 'ln';
                    tdOld.textContent = r.aNo === '' ? '' : r.aNo;
                    tdNew.textContent = r.bNo === '' ? '' : r.bNo;

                    const tdText = document.createElement('td'); tdText.className = 'text'; tdText.innerHTML = r.html;

                    tr.appendChild(tdSym); tr.appendChild(tdOld); tr.appendChild(tdNew); tr.appendChild(tdText);
                    frag.appendChild(tr);

                    if (r.kind === 'add') added++;
                    else if (r.kind === 'del') deleted++;
                    else {
                        // Two rows per modified line (old + new)
                        if (!modOpen) { modifiedPairs++; modOpen = true; } else { modOpen = false; }
                    }
                }
                el.body.appendChild(frag);
                el.body.setAttribute('aria-busy', 'false');

                el.stats.textContent = rows.length
                    ? `Changes — Added: ${added} · Deleted: ${deleted} · Modified: ${modifiedPairs}`
                    : 'No differences found.';
            }

            function compareNow() {
                const opts = {
                    ignoreWhitespace: el.optWhitespace.checked,
                    ignoreCase: el.optCase.checked
                };
                const origRaw = splitLines(el.orig.value);
                const changedRaw = splitLines(el.changed.value);

                // For comparison, normalized lines; for display, original lines
                const origCmp = origRaw.map(s => normalizeLine(s, opts));
                const changedCmp = changedRaw.map(s => normalizeLine(s, opts));

                const ops = lcsDiffArray(origCmp, changedCmp);
                const rows = buildRows(ops, origRaw, changedRaw, opts);
                renderRows(rows);

                // Adjust a rough line-number column width based on digits
                const maxDigits = String(Math.max(origRaw.length, changedRaw.length)).length;
                document.documentElement.style.setProperty('--ln-width', (Math.max(3, maxDigits) + 2) + 'ch');
            }

            // Controls
            el.compare.addEventListener('click', compareNow);
            el.swap.addEventListener('click', () => {
                const a = el.orig.value; el.orig.value = el.changed.value; el.changed.value = a;
                el.orig.focus();
            });
            el.clear.addEventListener('click', () => {
                el.orig.value = ''; el.changed.value = ''; el.body.innerHTML = ''; el.stats.textContent = '';
                el.orig.focus();
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') { e.preventDefault(); compareNow(); }
                if (e.key === 'Escape') { el.body.focus(); }
            });

            // Small starter example for quick try
            if (!el.orig.value && !el.changed.value) {
                el.orig.value = [
                    'alpha', 'bravo', 'charlie', 'delta', 'echo',
                    'foxtrot', 'golf', 'hotel', 'india'
                ].join('\n');
                el.changed.value = [
                    'alpha', 'BRAVO', 'charlie', 'delta', 'echo',
                    'golf', 'hotel', 'juliet', 'kilo'
                ].join('\n');
            }
        </script>
    </body>

</html>