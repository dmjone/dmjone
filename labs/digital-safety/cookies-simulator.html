<!DOCTYPE html>
<html lang="en" data-bs-theme="light">

    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Cookies & Consent Simulator — Digital Safety Labs</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/css/bootstrap.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.11.3/font/bootstrap-icons.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
        <style>
            /* Rural‑ready: high contrast, big touch targets, minimal CSS */
            .mono {
                font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace
            }

            .shadow-soft {
                box-shadow: 0 .35rem 1rem rgba(0, 0, 0, .06)
            }

            .vh-25 {
                height: 25vh
            }

            .scroll {
                overflow: auto
            }

            .large-btn .btn {
                min-width: 180px
            }

            .pill {
                border: 1px solid #dee2e6;
                border-radius: 9999px;
                padding: .1rem .5rem;
                display: inline-block
            }

            .kv {
                display: grid;
                grid-template-columns: 160px 1fr;
                gap: .25rem .75rem
            }

            .kv .k {
                color: #6c757d
            }

            .badge-cat {
                font-weight: 600
            }

            .badge-essential {
                background: #e7f5ff;
                color: #0b7285
            }

            .badge-analytics {
                background: #fff3bf;
                color: #ad6800
            }

            .badge-ads {
                background: #ffe3e3;
                color: #c92a2a
            }

            .badge-perso {
                background: #e6fcf5;
                color: #087f5b
            }

            .badge-test {
                background: #f1f3f5;
                color: #495057
            }

            @media (max-width: 767.98px) {
                .kv {
                    grid-template-columns: 120px 1fr
                }
            }
        </style>
    </head>

    <body>
        <!-- Top bar -->
        <nav class="navbar navbar-expand-lg bg-body-tertiary border-bottom">
            <div class="container-fluid">
                <span class="navbar-brand fw-semibold"><i class="bi bi-cookie me-2" aria-hidden="true"></i>Cookies & Consent Simulator</span>
                <div class="d-flex gap-2">
                    <button id="langToggle" class="btn btn-outline-secondary btn-sm" type="button">हिंदी</button>
                    <button id="resetBtn" class="btn btn-outline-danger btn-sm" type="button">Reset Demo</button>
                </div>
            </div>
        </nav>

        <!-- Consent banner (appears if no consent cookie) -->
        <div id="banner" class="border-bottom bg-light" hidden>
            <div class="container py-3">
                <div class="row g-3 align-items-center">
                    <div class="col-lg-8">
                        <div class="h6 mb-1" data-i18n="bnr_title">We use cookies for essential features and optional analytics/ads.</div>
                        <div class="small text-muted" data-i18n="bnr_text">Choose what to allow. You can change later. Optional cookies help measure use and personalise content.</div>
                    </div>
                    <div class="col-lg-4 d-flex flex-wrap gap-2 justify-content-lg-end">
                        <button id="btnReject" class="btn btn-outline-secondary" type="button" data-i18n="bnr_reject">Reject non‑essential</button>
                        <button id="btnCustomize" class="btn btn-outline-primary" type="button" data-i18n="bnr_custom">Customise</button>
                        <button id="btnAccept" class="btn btn-primary" type="button" data-i18n="bnr_accept">Accept all</button>
                    </div>
                </div>
            </div>
        </div>

        <main class="container py-4">
            <div class="alert alert-info shadow-soft" role="alert">
                <strong data-i18n="info_head">Show, don’t tell:</strong>
                <span data-i18n="info_body">This page demonstrates how cookies & consent work — first‑party vs third‑party, session vs persistent, SameSite & Secure flags, and what changes when you accept/reject categories. Nothing leaves your browser; this is an offline simulation.</span>
            </div>

            <!-- Section: Overview & quick toggles -->
            <section class="mb-3">
                <div class="card">
                    <div class="card-header fw-semibold" data-i18n="ov_title">Overview</div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-lg-6">
                                <div class="kv">
                                    <div class="k" data-i18n="ov_first">First‑party cookies</div>
                                    <div data-i18n="ov_first_txt">Set by this site (training page). Used for login, preferences, etc.</div>
                                    <div class="k" data-i18n="ov_third">Third‑party cookies</div>
                                    <div data-i18n="ov_third_txt">Set by embedded content (ads/analytics). Banned in many browsers — simulated here.</div>
                                    <div class="k" data-i18n="ov_session">Session vs Persistent</div>
                                    <div data-i18n="ov_session_txt">Session cookies vanish on close; persistent have expiry (days/months).</div>
                                    <div class="k">SameSite</div>
                                    <div data-i18n="ov_samesite">Controls cross‑site sending: <span class="pill">Lax</span> (default), <span class="pill">Strict</span>, <span class="pill">None</span> (+ <span class="pill">Secure</span> required).</div>
                                    <div class="k">Secure</div>
                                    <div data-i18n="ov_secure">Only sent over HTTPS. (This demo runs on your current origin.)</div>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="row g-2">
                                    <div class="col-12 col-sm-6">
                                        <div class="p-3 border rounded h-100 bg-light">
                                            <div class="small text-muted" data-i18n="consent_state">Consent state</div>
                                            <div id="consentBadge" class="h5 mb-1"><span class="badge text-bg-secondary">—</span></div>
                                            <div class="d-flex flex-wrap gap-1" id="consentTags"></div>
                                            <div class="mt-2 d-flex gap-2">
                                                <button class="btn btn-outline-primary btn-sm" id="btnChange" type="button" data-i18n="change_prefs">Change preferences</button>
                                                <button class="btn btn-outline-secondary btn-sm" id="btnClearConsent" type="button" data-i18n="clear_consent">Clear consent</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-12 col-sm-6">
                                        <div class="p-3 border rounded h-100 bg-light">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="toggle3p">
                                                <label class="form-check-label" for="toggle3p" data-i18n="block_3p">Block third‑party cookies (simulated)</label>
                                            </div>
                                            <div class="small text-muted" data-i18n="block_hint">Simulates browsers that block cross‑site cookies by default.</div>
                                            <div class="mt-2">
                                                <button class="btn btn-outline-secondary btn-sm" id="btnNewSession" type="button" data-i18n="new_session">Start new session (clear session cookies)</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section: Consent actions preview -->
            <section class="mb-3">
                <div class="card">
                    <div class="card-header fw-semibold" data-i18n="act_title">Consent actions (what gets set)</div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-lg-7">
                                <div class="d-flex flex-wrap gap-2 mb-2 large-btn">
                                    <button class="btn btn-primary" id="actAcceptAll" type="button" data-i18n="act_accept">Accept all</button>
                                    <button class="btn btn-outline-secondary" id="actReject" type="button" data-i18n="act_reject">Reject non‑essential</button>
                                    <button class="btn btn-outline-primary" id="actCustomize" type="button" data-i18n="act_custom">Customise…</button>
                                </div>
                                <div class="small text-muted" data-i18n="act_note">Below is a live preview of cookies this page will set for each category.</div>
                            </div>
                            <div class="col-lg-5">
                                <ul class="mb-0 small">
                                    <li><span class="badge badge-cat badge-essential">Essential</span> — login/session, CSRF, language.</li>
                                    <li><span class="badge badge-cat badge-analytics">Analytics</span> — page views, A/B tests.</li>
                                    <li><span class="badge badge-cat badge-ads">Advertising</span> — cross‑site ID, segments.</li>
                                    <li><span class="badge badge-cat badge-perso">Personalisation</span> — theme, recent items.</li>
                                </ul>
                            </div>
                        </div>
                        <hr />
                        <div class="row g-3">
                            <div class="col-lg-6">
                                <div class="h6">Preview</div>
                                <pre id="preview" class="p-3 bg-light border rounded mono small"></pre>
                            </div>
                            <div class="col-lg-6">
                                <div class="h6">Explanation</div>
                                <div id="explain" class="small"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section: Cookie jar (real cookies) -->
            <section class="mb-3">
                <div class="card">
                    <div class="card-header fw-semibold" data-i18n="jar_title">Cookie jar (this origin)</div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-sm align-middle">
                                <thead class="table-light">
                                    <tr class="small">
                                        <th>Name</th>
                                        <th>Value</th>
                                        <th>Category</th>
                                        <th>Expires</th>
                                        <th>SameSite</th>
                                        <th>Secure</th>
                                        <th>Path</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="jarT"></tbody>
                            </table>
                        </div>
                        <div class="d-flex flex-wrap gap-2">
                            <button class="btn btn-outline-secondary btn-sm" id="btnClearAll" type="button">Delete all demo cookies</button>
                            <button class="btn btn-outline-secondary btn-sm" id="btnSetSessionTest" type="button">Set session test</button>
                            <button class="btn btn-outline-secondary btn-sm" id="btnSetPersistentTest" type="button">Set persistent test (1 day)</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section: Third‑party tracking simulation -->
            <section class="mb-3">
                <div class="card">
                    <div class="card-header fw-semibold" data-i18n="tp_title">Third‑party tracking (simulated)</div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-lg-7">
                                <div class="row g-2">
                                    <div class="col-6 col-md-4">
                                        <div class="p-3 border rounded h-100">
                                            <div class="small text-muted">Visit</div>
                                            <div class="fw-semibold">News Portal</div>
                                            <button class="btn btn-outline-primary btn-sm mt-2" data-site="news">Visit</button>
                                        </div>
                                    </div>
                                    <div class="col-6 col-md-4">
                                        <div class="p-3 border rounded h-100">
                                            <div class="small text-muted">Visit</div>
                                            <div class="fw-semibold">Shopping Site</div>
                                            <button class="btn btn-outline-primary btn-sm mt-2" data-site="shop">Visit</button>
                                        </div>
                                    </div>
                                    <div class="col-6 col-md-4">
                                        <div class="p-3 border rounded h-100">
                                            <div class="small text-muted">Visit</div>
                                            <div class="fw-semibold">Health Blog</div>
                                            <button class="btn btn-outline-primary btn-sm mt-2" data-site="health">Visit</button>
                                        </div>
                                    </div>
                                    <div class="col-6 col-md-4">
                                        <div class="p-3 border rounded h-100">
                                            <div class="small text-muted">Visit</div>
                                            <div class="fw-semibold">Jobs Portal</div>
                                            <button class="btn btn-outline-primary btn-sm mt-2" data-site="jobs">Visit</button>
                                        </div>
                                    </div>
                                    <div class="col-6 col-md-4">
                                        <div class="p-3 border rounded h-100">
                                            <div class="small text-muted">Visit</div>
                                            <div class="fw-semibold">Finance Tips</div>
                                            <button class="btn btn-outline-primary btn-sm mt-2" data-site="finance">Visit</button>
                                        </div>
                                    </div>
                                    <div class="col-6 col-md-4">
                                        <div class="p-3 border rounded h-100">
                                            <div class="small text-muted">Visit</div>
                                            <div class="fw-semibold">Education Forum</div>
                                            <button class="btn btn-outline-primary btn-sm mt-2" data-site="edu">Visit</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-5">
                                <div class="p-3 border rounded bg-light h-100">
                                    <div class="small text-muted">Simulated ad network cookie (third‑party)</div>
                                    <div class="mono">adnet.tid = <span id="tid">—</span></div>
                                    <div class="small text-muted mt-2">Profile built from visited sites:</div>
                                    <ul id="profile" class="mb-2 small"></ul>
                                    <div class="small text-muted">With <strong>3rd‑party blocked</strong> or <strong>Ads off</strong>, this ID is not shared across sites.</div>
                                    <div class="mt-2">
                                        <button class="btn btn-outline-secondary btn-sm" id="btnResetTracker" type="button">Reset tracker</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section: Simple login demo (session vs remember me) -->
            <section class="mb-3">
                <div class="card">
                    <div class="card-header fw-semibold" data-i18n="login_title">Login demo (session vs “remember me”)</div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-lg-6">
                                <form id="loginForm" class="row gy-2">
                                    <div class="col-12">
                                        <label class="form-label" data-i18n="label_user">Username (demo)</label>
                                        <input id="lg_user" class="form-control" placeholder="ravi" />
                                    </div>
                                    <div class="col-12">
                                        <label class="form-label" data-i18n="label_pass">Password (demo)</label>
                                        <input id="lg_pass" type="password" class="form-control" placeholder="••••••" />
                                    </div>
                                    <div class="col-12 form-check">
                                        <input id="lg_rem" class="form-check-input" type="checkbox" />
                                        <label class="form-check-label" for="lg_rem" data-i18n="label_rem">Remember me (persistent cookie)</label>
                                    </div>
                                    <div class="col-12 d-flex gap-2">
                                        <button class="btn btn-primary" type="submit" data-i18n="btn_login">Login</button>
                                        <button class="btn btn-outline-secondary" id="btnLogout" type="button" data-i18n="btn_logout">Logout</button>
                                    </div>
                                </form>
                            </div>
                            <div class="col-lg-6">
                                <div class="p-3 border rounded bg-light">
                                    <div class="small text-muted">Current session</div>
                                    <div class="mono">session.user = <span id="sessUser">—</span></div>
                                    <div class="mono">cookie.sessionid = <span id="sessId">—</span></div>
                                    <div class="mono">cookie.remember = <span id="remId">—</span></div>
                                    <div class="small text-muted mt-2">“Remember me” writes a <em>persistent</em> cookie. Session login uses a <em>session</em> cookie.</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Event stream -->
            <section class="mb-3">
                <div class="card">
                    <div class="card-header fw-semibold">Event Stream</div>
                    <div class="card-body p-2 vh-25 scroll">
                        <table class="table table-sm align-middle mb-0">
                            <thead>
                                <tr class="small">
                                    <th>Time</th>
                                    <th>Event</th>
                                    <th>Details</th>
                                </tr>
                            </thead>
                            <tbody id="eventT"></tbody>
                        </table>
                    </div>
                    <div class="card-footer d-flex flex-wrap gap-2">
                        <button id="btnExport" class="btn btn-outline-secondary btn-sm" type="button">Export Evidence (JSON)</button>
                    </div>
                </div>
            </section>
        </main>

        <!-- Customise modal -->
        <div class="modal fade" id="consentModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" data-i18n="cm_title">Choose your cookie settings</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="c_essential" checked disabled>
                            <label class="form-check-label" for="c_essential"><span class="badge badge-cat badge-essential">Essential</span> <span class="small text-muted" data-i18n="cm_essential">(required for security & core functions)</span></label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="c_analytics">
                            <label class="form-check-label" for="c_analytics"><span class="badge badge-cat badge-analytics">Analytics</span> <span class="small text-muted" data-i18n="cm_analytics">(measure usage, improve site)</span></label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="c_ads">
                            <label class="form-check-label" for="c_ads"><span class="badge badge-cat badge-ads">Advertising</span> <span class="small text-muted" data-i18n="cm_ads">(ad IDs, cross‑site)</span></label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="c_perso">
                            <label class="form-check-label" for="c_perso"><span class="badge badge-cat badge-perso">Personalisation</span> <span class="small text-muted" data-i18n="cm_perso">(theme, language, recent)</span></label>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal" id="cm_reject" data-i18n="cm_reject">Reject non‑essential</button>
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal" id="cm_save" data-i18n="cm_save">Save choices</button>
                    </div>
                </div>
            </div>
        </div>

        <footer class="border-top py-3 text-center small text-muted">
            Digital Safety Labs — stores demo data under <span class="mono">localStorage["DSL_<slug>_V1"]</span>
        </footer>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/js/bootstrap.bundle.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script>
            // ===== Storage namespace =====
            const SLUG = (location.pathname.split('/').filter(Boolean).pop() || 'cookies-simulator.html').replace(/[^a-z0-9-]/gi, '_').toLowerCase();
            const KEY = `DSL_${SLUG}_V1`;

            // ===== State =====
            const DEFAULT = () => ({
                version: '1.0.0',
                sessionId: 'dsl-' + Math.random().toString(36).slice(2, 10),
                consent: { essential: true, analytics: false, ads: false, perso: false, ts: null },
                thirdPartyBlocked: false,
                visits: {},
                tracker: { tid: null, profile: [] },
                sessionUser: null,
                events: []
            });

            let state = load();

            function load() { try { return JSON.parse(localStorage.getItem(KEY)) || DEFAULT(); } catch (e) { return DEFAULT(); } }
            function save() { localStorage.setItem(KEY, JSON.stringify(state)); }
            function now() { return new Date().toISOString(); }
            function addEvent(type, payload) { state.events.unshift({ ts: now(), type, payload }); save(); renderEvents(); }
            function esc(x) { x = String(x ?? ''); return x.replace(/[&<>"']/g, c => ({ "&": "&amp;", "<": "&lt;", ">": "&gt;", "\"": "&quot;", "'": "&#39;" }[c])); }

            // ===== Cookie helpers =====
            function setCookie(name, value, { days = null, samesite = 'Lax', secure = false, path = '/' } = {}) {
                let str = `${name}=${encodeURIComponent(value)}; Path=${path}`;
                if (days !== null) { const d = new Date(Date.now() + days * 864e5); str += `; Expires=${d.toUTCString()}`; }
                if (samesite) { str += `; SameSite=${samesite}`; }
                if (secure) { str += `; Secure`; }
                document.cookie = str;
            }
            function delCookie(name) { document.cookie = `${name}=; Path=/; Expires=Thu, 01 Jan 1970 00:00:00 GMT`; }
            function getCookies() {
                const jar = document.cookie ? document.cookie.split('; ') : [];
                return jar.map(kv => { const [k, ...rest] = kv.split('='); const v = decodeURIComponent(rest.join('=')); return { name: k, value: v }; });
            }

            // ===== Demo cookies per category =====
            function demoCookiesFor(consent) {
                const items = [];
                // Essential (always)
                items.push({ name: 'dsl_csrftoken', value: rnd(12), cat: 'Essential', days: 1, samesite: 'Lax', secure: false });
                items.push({ name: 'dsl_lang', value: (lang || 'en'), cat: 'Essential', days: 30, samesite: 'Lax', secure: false });
                // Analytics
                if (consent.analytics) { items.push({ name: 'dsl_ga', value: rnd(16), cat: 'Analytics', days: 180, samesite: 'Lax', secure: true }); items.push({ name: 'dsl_ab', value: ['A', 'B'][Math.floor(Math.random() * 2)], cat: 'Analytics', days: 7, samesite: 'Lax', secure: true }); }
                // Advertising
                if (consent.ads) { items.push({ name: 'dsl_adid', value: rnd(18), cat: 'Advertising', days: 365, samesite: 'None', secure: true }); items.push({ name: 'dsl_adseg', value: segmentsFromProfile().join('.'), cat: 'Advertising', days: 90, samesite: 'None', secure: true }); }
                // Personalisation
                if (consent.perso) { items.push({ name: 'dsl_theme', value: 'contrast', cat: 'Personalisation', days: 120, samesite: 'Lax', secure: false }); items.push({ name: 'dsl_recent', value: JSON.stringify(Object.keys(state.visits).slice(-3)), cat: 'Personalisation', days: 14, samesite: 'Lax', secure: false }); }
                return items;
            }

            // ===== Consent banner & changes =====
            function applyConsent(consent) {
                state.consent = { ...state.consent, ...consent, ts: now() };
                save();
                // Write consent cookie itself
                setCookie('dsl_consent', JSON.stringify(state.consent), { days: 365, samesite: 'Lax', secure: false });
                // Set demo cookies according to categories
                const items = demoCookiesFor(state.consent);
                // Clear old demo cookies first
                ['dsl_csrftoken', 'dsl_lang', 'dsl_ga', 'dsl_ab', 'dsl_adid', 'dsl_adseg', 'dsl_theme', 'dsl_recent'].forEach(delCookie);
                items.forEach(c => setCookie(c.name, c.value, { days: c.days, samesite: c.samesite, secure: c.secure }));
                addEvent('consent_applied', { consent: state.consent });
                renderConsentBox(); renderJar(); renderPreview();
                // Show/Hide banner
                document.getElementById('banner').hidden = !!readConsent();
            }

            function readConsent() {
                const c = getCookies().find(x => x.name === 'dsl_consent');
                if (!c) return null; try { return JSON.parse(c.value); } catch (e) { return null; }
            }

            // ===== Preview & explanation =====
            function renderPreview() {
                const p = demoCookiesFor(state.consent);
                const lines = p.map(c => `${c.name}=${truncate(c.value, 32)}; Max-Age=${c.days ? c.days * 86400 : 'session'}; SameSite=${c.samesite}${c.secure ? '; Secure' : ''}`);
                document.getElementById('preview').textContent = lines.join('\n') || '(no optional cookies)';
                const ex = [];
                if (state.consent.analytics) { ex.push('Analytics: helps count visits and run A/B tests. Does not store your password.'); }
                if (state.consent.ads) { ex.push('Advertising: creates a cross‑site ad ID (SameSite=None; Secure). May link visits across different sites.'); }
                if (state.consent.perso) { ex.push('Personalisation: remembers theme/language and recent items.'); }
                if (!ex.length) ex.push('Only essential cookies (security, language).');
                document.getElementById('explain').innerHTML = '<ul class="mb-0">' + ex.map(x => `<li>${esc(x)}</li>`).join('') + '</ul>';
            }

            // ===== Consent box =====
            function renderConsentBox() {
                const tagEl = document.getElementById('consentTags'); tagEl.innerHTML = '';
                const c = state.consent;
                const badge = c.ads || c.analytics || c.perso ? 'text-bg-success' : 'text-bg-secondary';
                document.getElementById('consentBadge').innerHTML = `<span class="badge ${badge}">${c.ads || c.analytics || c.perso ? 'Custom/Accepted' : 'Essential only'}</span>`;
                [['Essential', true], ['Analytics', c.analytics], ['Advertising', c.ads], ['Personalisation', c.perso]].forEach(([name, on]) => {
                    const span = document.createElement('span'); span.className = 'pill small ' + (on ? 'bg-light' : ''); span.textContent = `${name}: ${on ? 'On' : 'Off'}`; tagEl.appendChild(span);
                });
                document.getElementById('toggle3p').checked = !!state.thirdPartyBlocked;
            }

            // ===== Cookie jar table =====
            function renderJar() {
                const t = document.getElementById('jarT'); t.innerHTML = '';
                const cats = { dsl_csrftoken: 'Essential', dsl_lang: 'Essential', dsl_ga: 'Analytics', dsl_ab: 'Analytics', dsl_adid: 'Advertising', dsl_adseg: 'Advertising', dsl_theme: 'Personalisation', dsl_recent: 'Personalisation' };
                const map = getCookies();
                for (const { name, value } of map) {
                    const tr = document.createElement('tr');
                    const cat = cats[name] || 'Test';
                    tr.innerHTML = `
          <td class="mono">${esc(name)}</td>
          <td class="mono small">${esc(truncate(value, 48))}</td>
          <td>${badge(cat)}</td>
          <td class="small">${esc(expiryOf(name) || 'session')}</td>
          <td class="small">${esc(sameSiteOf(name) || '-')}</td>
          <td class="small">${isSecure(name) ? 'Yes' : 'No'}</td>
          <td class="small">/</td>
          <td class="text-end"><button class="btn btn-sm btn-outline-danger" data-del="${esc(name)}">Delete</button></td>`;
                    t.appendChild(tr);
                }
            }

            // NOTE: document.cookie API does not expose attributes; below are best‑effort lookups from what we set
            const ATTRS = {}; // name -> {expires, samesite, secure}
            function rememberAttrs(name, { days = null, samesite = 'Lax', secure = false }) {
                ATTRS[name] = { expires: days ? new Date(Date.now() + days * 864e5).toUTCString() : null, samesite, secure };
            }
            function expiryOf(name) { return ATTRS[name]?.expires || null; }
            function sameSiteOf(name) { return ATTRS[name]?.samesite || null; }
            function isSecure(name) { return !!ATTRS[name]?.secure; }

            // Overwrite setCookie to remember attrs
            const _setCookie = setCookie; setCookie = function (name, value, opts) { rememberAttrs(name, opts || {}); _setCookie(name, value, opts); };

            // ===== Third‑party tracker simulation =====
            function ensureTid() { if (!state.tracker.tid) { state.tracker.tid = 'ad-' + rnd(12); } save(); }
            function segmentsFromProfile() { const p = state.tracker.profile || []; return Array.from(new Set(p)).slice(0, 6); }
            function updateTrackerUI() {
                document.getElementById('tid').textContent = state.consent.ads && !state.thirdPartyBlocked ? (state.tracker.tid || '—') : 'blocked';
                const ul = document.getElementById('profile'); ul.innerHTML = ''; segmentsFromProfile().forEach(s => { const li = document.createElement('li'); li.textContent = s; ul.appendChild(li); });
            }
            function visitSite(kind) {
                state.visits[kind] = (state.visits[kind] || 0) + 1; save(); addEvent('visit_site', { kind });
                if (state.consent.ads && !state.thirdPartyBlocked) { ensureTid(); if (!state.tracker.profile.includes(kind)) state.tracker.profile.push(kind); save(); }
                updateTrackerUI(); renderPreview();
            }
            function resetTracker() { state.tracker = { tid: null, profile: [] }; save(); updateTrackerUI(); addEvent('tracker_reset', {}); }

            // ===== Login demo =====
            function login(user, remember) {
                state.sessionUser = user; sessionStorage.setItem('dsl_user', user);
                setCookie('dsl_sessionid', rnd(10), { samesite: 'Lax' }); // session cookie
                rememberAttrs('dsl_sessionid', { samesite: 'Lax' });
                if (remember) { setCookie('dsl_remember', rnd(18), { days: 30, samesite: 'Lax', secure: true }); rememberAttrs('dsl_remember', { days: 30, samesite: 'Lax', secure: true }); }
                save(); addEvent('login', { user, remember }); renderLoginBox(); renderJar();
            }
            function logout() { state.sessionUser = null; sessionStorage.removeItem('dsl_user'); delCookie('dsl_sessionid'); delCookie('dsl_remember'); addEvent('logout', {}); renderLoginBox(); renderJar(); }
            function renderLoginBox() {
                document.getElementById('sessUser').textContent = state.sessionUser || '—';
                const c = getCookies();
                document.getElementById('sessId').textContent = c.find(x => x.name === 'dsl_sessionid') ? 'present' : '—';
                document.getElementById('remId').textContent = c.find(x => x.name === 'dsl_remember') ? 'present' : '—';
            }

            // ===== Utilities =====
            function rnd(n) { const s = 'abcdefghijklmnopqrstuvwxyz0123456789'; let o = ''; while (o.length < n) o += s[Math.floor(Math.random() * s.length)]; return o; }
            function truncate(s, n) { s = String(s); return s.length > n ? s.slice(0, n - 1) + '…' : s; }
            function badge(cat) { const cls = cat === 'Essential' ? 'badge-essential' : cat === 'Analytics' ? 'badge-analytics' : cat === 'Advertising' ? 'badge-ads' : cat === 'Personalisation' ? 'badge-perso' : 'badge-test'; return `<span class="badge ${cls}">${cat}</span>`; }
            function setVisible(id, show) { document.getElementById(id).hidden = !show; }
            function renderEvents() { const t = document.getElementById('eventT'); t.innerHTML = ''; for (const ev of state.events) { const tr = document.createElement('tr'); tr.innerHTML = `<td class="small text-muted">${esc(ev.ts)}</td><td>${esc(ev.type)}</td><td><span class=\"mono\">${esc(JSON.stringify(ev.payload))}</span></td>`; t.appendChild(tr); } }
            function exportJSON() { const blob = new Blob([JSON.stringify(state, null, 2)], { type: 'application/json' }); const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `cookies-evidence-${state.sessionId}.json`; a.click(); URL.revokeObjectURL(a.href); }
            function resetAll() {
                localStorage.removeItem(KEY); state = DEFAULT(); save(); // Also clear demo cookies
                ['dsl_consent', 'dsl_csrftoken', 'dsl_lang', 'dsl_ga', 'dsl_ab', 'dsl_adid', 'dsl_adseg', 'dsl_theme', 'dsl_recent', 'dsl_sessionid', 'dsl_remember'].forEach(delCookie);
                location.reload();
            }

            // ===== Language (EN/HI minimal) =====
            const I18N = {
                en: { bnr_title: 'We use cookies for essential features and optional analytics/ads.', bnr_text: 'Choose what to allow. You can change later. Optional cookies help measure use and personalise content.', bnr_reject: 'Reject non‑essential', bnr_custom: 'Customise', bnr_accept: 'Accept all', info_head: 'Show, don’t tell:', info_body: 'This page demonstrates how cookies & consent work — first‑party vs third‑party, session vs persistent, SameSite & Secure flags, and what changes when you accept/reject categories. Nothing leaves your browser; this is an offline simulation.', ov_title: 'Overview', ov_first: 'First‑party cookies', ov_first_txt: 'Set by this site (training page). Used for login, preferences, etc.', ov_third: 'Third‑party cookies', ov_third_txt: 'Set by embedded content (ads/analytics). Banned in many browsers — simulated here.', ov_session: 'Session vs Persistent', ov_session_txt: 'Session cookies vanish on close; persistent have expiry (days/months).', ov_samesite: 'Controls cross‑site sending: Lax (default), Strict, None (+ Secure required).', ov_secure: 'Only sent over HTTPS. (This demo runs on your current origin.)', consent_state: 'Consent state', change_prefs: 'Change preferences', clear_consent: 'Clear consent', block_3p: 'Block third‑party cookies (simulated)', block_hint: 'Simulates browsers that block cross‑site cookies by default.', new_session: 'Start new session (clear session cookies)', act_title: 'Consent actions (what gets set)', act_accept: 'Accept all', act_reject: 'Reject non‑essential', act_custom: 'Customise…', act_note: 'Below is a live preview of cookies this page will set for each category.', jar_title: 'Cookie jar (this origin)', tp_title: 'Third‑party tracking (simulated)', login_title: 'Login demo (session vs “remember me”)', label_user: 'Username (demo)', label_pass: 'Password (demo)', label_rem: 'Remember me (persistent cookie)', btn_login: 'Login', btn_logout: 'Logout', cm_title: 'Choose your cookie settings', cm_essential: 'required for security & core functions', cm_analytics: 'measure usage, improve site', cm_ads: 'ad IDs, cross‑site', cm_perso: 'theme, language, recent', cm_reject: 'Reject non‑essential', cm_save: 'Save choices' },
                hi: { bnr_title: 'इस पेज पर ज़रूरी व वैकल्पिक (एनालिटिक्स/विज्ञापन) कुकीज़ का उपयोग होता है।', bnr_text: 'आप क्या अनुमति देते हैं, चुनें। बाद में बदल सकते हैं। वैकल्पिक कुकीज़ उपयोग मापने व सामग्री व्यक्ति‑अनुकूल बनाने में मदद करती हैं।', bnr_reject: 'गैर‑ज़रूरी अस्वीकार', bnr_custom: 'कस्टमाइज़', bnr_accept: 'सब स्वीकारें', info_head: 'दिखाकर समझाएं:', info_body: 'यह पेज कुकी व सहमति का काम दिखाता है — फर्स्ट‑पार्टी बनाम थर्ड‑पार्टी, सेशन बनाम पर्सिस्टेंट, SameSite व Secure, और अनुमति देने/ना देने पर क्या बदलता है। यह ऑफलाइन डेमो है — कोई डेटा बाहर नहीं जाता।', ov_title: 'ओवरव्यू', ov_first: 'फर्स्ट‑पार्टी कुकीज़', ov_first_txt: 'यही साइट सेट करती है — लॉगिन, पसंद आदि।', ov_third: 'थर्ड‑पार्टी कुकीज़', ov_third_txt: 'एम्बेड किए कंटेंट (विज्ञापन/एनालिटिक्स) सेट करते हैं। कई ब्राउज़र में बंद — यहाँ सिमुलेटेड।', ov_session: 'सेशन बनाम पर्सिस्टेंट', ov_session_txt: 'सेशन कुकी ब्राउज़र बंद होते ही हटती; पर्सिस्टेंट में एक्सपायरी होती।', ov_samesite: 'क्रॉस‑साइट भेजना नियंत्रित: Lax (डिफ़ॉल्ट), Strict, None (+ Secure ज़रूरी)।', ov_secure: 'सिर्फ HTTPS पर भेजी जाती हैं।', consent_state: 'सहमति स्थिति', change_prefs: 'पसंद बदलें', clear_consent: 'सहमति हटाएँ', block_3p: 'थर्ड‑पार्टी कुकी ब्लॉक (सिमुलेशन)', block_hint: 'ऐसा ब्राउज़र मानकर चलें जो क्रॉस‑साइट कुकी रोकता है।', new_session: 'नया सेशन (सेशन कुकी साफ़)', act_title: 'सहमति क्रियाएँ (क्या सेट होगा)', act_accept: 'सब स्वीकारें', act_reject: 'गैर‑ज़रूरी अस्वीकार', act_custom: 'कस्टमाइज़…', act_note: 'नीचे हर श्रेणी के लिए सेट होने वाली कुकीज़ का लाइव प्रीव्यू है।', jar_title: 'कुकी जार (यह साइट)', tp_title: 'थर्ड‑पार्टी ट्रैकिंग (सिमुलेशन)', login_title: 'लॉगिन डेमो (सेशन बनाम “रिमेम्बर मी”)', label_user: 'यूज़रनेम (डेमो)', label_pass: 'पासवर्ड (डेमो)', label_rem: 'रिमेम्बर मी (पर्सिस्टेंट कुकी)', btn_login: 'लॉगिन', btn_logout: 'लॉगआउट', cm_title: 'अपनी कुकी सेटिंग चुनें', cm_essential: 'सुरक्षा व मुख्य कार्य हेतु आवश्यक', cm_analytics: 'उपयोग माप, साइट सुधार', cm_ads: 'विज्ञापन ID, क्रॉस‑साइट', cm_perso: 'थीम, भाषा, हालिया', cm_reject: 'गैर‑ज़रूरी अस्वीकार', cm_save: 'सेव करें' }
            };
            let lang = localStorage.getItem('DSL_LANG') || (navigator.language.startsWith('hi') ? 'hi' : 'en');
            function applyLang() { const L = I18N[lang] || I18N.en; document.querySelectorAll('[data-i18n]').forEach(el => { const k = el.getAttribute('data-i18n'); if (L[k]) el.textContent = L[k]; }); document.getElementById('langToggle').textContent = (lang === 'en' ? 'हिंदी' : 'English'); }

            // ===== Init & listeners =====
            function init() {
                applyLang(); renderConsentBox(); renderPreview(); renderJar(); updateTrackerUI(); renderLoginBox(); renderEvents();
                // Banner visibility
                document.getElementById('banner').hidden = !!readConsent();

                // Banner buttons
                document.getElementById('btnReject').addEventListener('click', () => applyConsent({ analytics: false, ads: false, perso: false }));
                document.getElementById('btnAccept').addEventListener('click', () => applyConsent({ analytics: true, ads: true, perso: true }));
                document.getElementById('btnCustomize').addEventListener('click', openCustomize);

                // Overview box buttons
                document.getElementById('btnChange').addEventListener('click', openCustomize);
                document.getElementById('btnClearConsent').addEventListener('click', () => { delCookie('dsl_consent'); addEvent('consent_cleared', {}); document.getElementById('banner').hidden = false; });
                document.getElementById('toggle3p').addEventListener('change', (e) => { state.thirdPartyBlocked = e.target.checked; save(); updateTrackerUI(); addEvent('thirdparty_toggle', { blocked: state.thirdPartyBlocked }); });
                document.getElementById('btnNewSession').addEventListener('click', () => { delCookie('dsl_sessionid'); sessionStorage.clear(); addEvent('new_session', {}); renderLoginBox(); renderJar(); });

                // Consent actions
                document.getElementById('actAcceptAll').addEventListener('click', () => applyConsent({ analytics: true, ads: true, perso: true }));
                document.getElementById('actReject').addEventListener('click', () => applyConsent({ analytics: false, ads: false, perso: false }));
                document.getElementById('actCustomize').addEventListener('click', openCustomize);

                // Jar actions
                document.getElementById('btnClearAll').addEventListener('click', () => { ['dsl_csrftoken', 'dsl_lang', 'dsl_ga', 'dsl_ab', 'dsl_adid', 'dsl_adseg', 'dsl_theme', 'dsl_recent', 'dsl_sessionid', 'dsl_remember'].forEach(delCookie); addEvent('demo_cookies_cleared', {}); renderJar(); });
                document.getElementById('btnSetSessionTest').addEventListener('click', () => { setCookie('dsl_test_session', rnd(6), { samesite: 'Lax' }); rememberAttrs('dsl_test_session', { samesite: 'Lax' }); addEvent('set_cookie', { name: 'dsl_test_session' }); renderJar(); });
                document.getElementById('btnSetPersistentTest').addEventListener('click', () => { setCookie('dsl_test_day', rnd(6), { days: 1, samesite: 'Lax', secure: true }); rememberAttrs('dsl_test_day', { days: 1, samesite: 'Lax', secure: true }); addEvent('set_cookie', { name: 'dsl_test_day' }); renderJar(); });
                document.getElementById('jarT').addEventListener('click', (e) => { const b = e.target.closest('[data-del]'); if (!b) return; delCookie(b.getAttribute('data-del')); addEvent('delete_cookie', { name: b.getAttribute('data-del') }); renderJar(); });

                // 3p visits
                document.querySelectorAll('[data-site]').forEach(b => b.addEventListener('click', () => visitSite(b.getAttribute('data-site'))));
                document.getElementById('btnResetTracker').addEventListener('click', resetTracker);

                // Login
                document.getElementById('loginForm').addEventListener('submit', (e) => { e.preventDefault(); const u = document.getElementById('lg_user').value.trim() || 'user'; const r = document.getElementById('lg_rem').checked; login(u, r); });
                document.getElementById('btnLogout').addEventListener('click', logout);

                // Misc
                document.getElementById('btnExport').addEventListener('click', exportJSON);
                document.getElementById('resetBtn').addEventListener('click', resetAll);
                document.getElementById('langToggle').addEventListener('click', () => { lang = (lang === 'en' ? 'hi' : 'en'); localStorage.setItem('DSL_LANG', lang); applyLang(); renderPreview(); });

                addEvent('demo_loaded', { ua: navigator.userAgent, lang: navigator.language });
            }

            function openCustomize() {
                document.getElementById('c_analytics').checked = !!state.consent.analytics;
                document.getElementById('c_ads').checked = !!state.consent.ads;
                document.getElementById('c_perso').checked = !!state.consent.perso;
                const m = new bootstrap.Modal(document.getElementById('consentModal')); m.show();
                document.getElementById('cm_reject').onclick = () => applyConsent({ analytics: false, ads: false, perso: false });
                document.getElementById('cm_save').onclick = () => applyConsent({ analytics: document.getElementById('c_analytics').checked, ads: document.getElementById('c_ads').checked, perso: document.getElementById('c_perso').checked });
            }

            document.addEventListener('DOMContentLoaded', init);
        </script>
    </body>

</html>